<!DOCTYPE html>
<html lang="pt-BR">
<style>
    body{
        margin-left: 10px !important;
        margin-right: 10px !important;
        padding-left: 10px !important;
        padding-right: 10px !important;
    }
</style>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RPG - Estrutura de Missões</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">
  
  <div class=" my-4">
    <h1 class="text-center mb-4">Guia de Missões</h1>

    <div class="mb-4">
      <label for="missionSelect" class="form-label">Selecione uma missão:</label>
      <select id="missionSelect" class="form-select"></select>
    </div>

    <div id="missionContainer" class="row g-4"></div>
  </div>

  <script>

    var achievements = [];
    var debuffs = [];
    var mission_selected;

    // JSON com as missões
    // aqui a melhoria se fará necessária pela quantidade de missões, ou seja, vc vai precisar importar o conteudo json de um arquivo separado que só vai ter o array de json
    const missions = [
      {
        id: 1,
        name: "Tutorial",
        boss: [
            { id: 1, name: "Boss", attack: "Nome do boss", buffs: ["Defesa Aprimorada", "Velocidade Aumentada"], debuffs: ["Envenenado", "Enfraquecido"], img: "https://tinyurl.com/monster-teste"}
        ],
        tests: [
          { id: 1, description: "Nome do teste", success: ["Buff Teste 1"], fail: ["Debuff Teste 1"] },
          { id: 2, description: "Nome do teste", success: ["Buff Teste 2"], fail: ["Debuff Teste 2"] }
        ],
        events: [
          { id: 1, description: "Nome do evento", success: ["Buff Evento 1"], fail: ["Debuff Evento 1"] },
          { id: 2, description: "Nome do evento", success: ["Buff Evento 2"], fail: ["Debuff Evento 2"] }
        ],
        monsters: [
          { id: 1, name: "Monstro A", attack: "Mordida Selvagem", buffs: ["Defesa Aprimorada", "Velocidade Aumentada"], debuffs: ["Envenenado", "Enfraquecido"], img: "https://tinyurl.com/monster-teste" },
          { id: 2, name: "Monstro B", attack: "Investida Brutal", buffs: ["Regeneração", "Força Aprimorada"], debuffs: ["Atordoado", "Sangramento"], img: "https://tinyurl.com/monster-teste" },
          { id: 3, name: "Monstro A", attack: "Mordida Selvagem", buffs: ["Defesa Aprimorada", "Velocidade Aumentada"], debuffs: ["Envenenado", "Enfraquecido"], img: "https://tinyurl.com/monster-teste" },
          { id: 4, name: "Monstro A", attack: "Mordida Selvagem", buffs: ["Defesa Aprimorada", "Velocidade Aumentada"], debuffs: ["Envenenado", "Enfraquecido"], img: "https://tinyurl.com/monster-teste" },
          { id: 5, name: "Monstro A", attack: "Mordida Selvagem", buffs: ["Defesa Aprimorada", "Velocidade Aumentada"], debuffs: ["Envenenado", "Enfraquecido"], img: "https://tinyurl.com/monster-teste" },
        ],
        reward: {
          coins: 500,
          honorPoints: 50,
          items: ["Espada Rara", "Poção de Cura"],
          experience: 1200
        }
      },
      {
        id: 2,
        name: "Ja é dos vera",
        boss: [
            { id: 3, name: "Boss dificil", attack: "Nome do boss", buffs: ["Defesa Aprimorada", "Velocidade Aumentada"], debuffs: ["Envenenado", "Enfraquecido"], img: "https://tinyurl.com/monster-teste"}
        ],
        tests: [
          { id: 1, description: "Teste 1 da missão 2", success: ["Buff Teste 1"], fail: ["Debuff Teste 1"] }
        ],
        events: [
          { id: 1, description: "Evento 1 da missão 2", success: ["Buff Evento 1"], fail: ["Debuff Evento 1"] }
        ],
        monsters: [
          { id: 1, name: "Monstro C", attack: "Garra Sombria", buffs: ["Camuflagem", "Fúria"], debuffs: ["Queimadura", "Lentidão"], img: "https://tinyurl.com/monster-teste" }
        ],
        reward: {
          coins: 300,
          honorPoints: 30,
          items: ["Escudo Antigo"],
          experience: 800
        }
      }
    ];

    const missionSelect = document.getElementById("missionSelect");
    const missionContainer = document.getElementById("missionContainer");

    // add as missões no combobox
    missions.forEach(mission => {
      const option = document.createElement("option");
      option.value = mission.id;
      option.textContent = `Missão ${mission.id}`;
      missionSelect.appendChild(option);
    });



    // aqui é a estrutura js com html de forma que eu pudesse deixar ninamicas as variaveis sem ter que usar alguma lib reativa
    // a melhoria aqui seria vc tentar ler o html de outro arquivo importando o conteudo ou passando as variaveis pra la.
    function renderMission(missionId) {
      const mission = missions.find(m => m.id == missionId);
      if (!mission) return;
      mission_selected = mission;

      achievements = [];
      debuffs = [];

      missionContainer.innerHTML = `
        <div class="col-12">
          <div class="card h-100 shadow-sm">
            <div class="card-header bg-primary text-white">
              <h4>Missão ${mission.id} : ${mission.name}</h4>
            </div>
            <div class="card-body">
                <!-- Testes -->
                <div class="accordion" id="accordionPanelsStayTestes">
                    <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayTestes-collapseTestes"
                        aria-expanded="false" aria-controls="panelsStayTestes-collapseTestes">
                        <h5><b>Testes</b></h5>
                        </button>
                    </h2>
                    <div id="panelsStayTestes-collapseTestes" class="accordion-collapse collapse">
                        <div class="accordion-body">
                        <div class="accordion">
                            ${mission.tests.map(teste => `
                            <div class="accordion-item" id="test-${teste.id}">
                                <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#panelsStayTeste${teste.id}-collapse"
                                    aria-expanded="false"
                                    aria-controls="panelsStayTeste${teste.id}-collapse">
                                    <b>#${teste.id} - ${teste.description}</b>
                                    <span class="status-icon ms-2"></span>
                                </button>
                                </h2>
                                <div id="panelsStayTeste${teste.id}-collapse" class="accordion-collapse collapse">
                                <div class="accordion-body">
                                    <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="card h-100">
                                        <h5 class="p-2">
                                            Sucesso
                                            <input class="form-check-input ms-2" type="checkbox"
                                            id="success-test-${teste.id}" data-type="success"
                                            data-context="test" data-id="${teste.id}">
                                        </h5>
                                        <div class="card-body">
                                            <p><strong>Benefícios:</strong> ${teste.success}</p>
                                        </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card h-100">
                                        <h5 class="p-2">
                                            Falha
                                            <input class="form-check-input ms-2" type="checkbox"
                                            id="fail-test-${teste.id}" data-type="fail"
                                            data-context="test" data-id="${teste.id}">
                                        </h5>
                                        <div class="card-body">
                                            <p><strong>Punições:</strong> ${teste.fail}</p>
                                        </div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                </div>
                            </div>
                            `).join("")}
                        </div>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Eventos -->
                <div class="accordion" id="accordionPanelsStayEventosExample">
                    <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayEventos-collapseOne"
                        aria-expanded="false" aria-controls="panelsStayEventos-collapseOne">
                        <h5><b>Eventos</b></h5>
                        </button>
                    </h2>
                    <div id="panelsStayEventos-collapseOne" class="accordion-collapse collapse">
                        <div class="accordion-body">
                        <div class="accordion">
                            ${mission.events.map(evento => `
                            <div class="accordion-item" id="event-${evento.id}">
                                <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#panelsStayEvento${evento.id}-collapse"
                                    aria-expanded="false"
                                    aria-controls="panelsStayEvento${evento.id}-collapse">
                                    <b>#${evento.id} - ${evento.description}</b>
                                    <span class="status-icon ms-2"></span>
                                </button>
                                </h2>
                                <div id="panelsStayEvento${evento.id}-collapse" class="accordion-collapse collapse">
                                <div class="accordion-body">
                                    <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="card h-100">
                                        <h5 class="p-2">
                                            Sucesso
                                            <input class="form-check-input ms-2" type="checkbox"
                                            id="success-event-${evento.id}" data-type="success"
                                            data-context="event" data-id="${evento.id}">
                                        </h5>
                                        <div class="card-body">
                                            <p><strong>Benefícios:</strong> ${evento.success}</p>
                                        </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card h-100">
                                        <h5 class="p-2">
                                            Falha
                                            <input class="form-check-input ms-2" type="checkbox"
                                            id="fail-event-${evento.id}" data-type="fail"
                                            data-context="event" data-id="${evento.id}">
                                        </h5>
                                        <div class="card-body">
                                            <p><strong>Punições:</strong> ${evento.fail}</p>
                                        </div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                </div>
                            </div>
                            `).join("")}
                        </div>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Monstros -->
                <div class="accordion" id="accordionPanelsStayMonstrosExample">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayMonstros-collapseOne" aria-expanded="false" aria-controls="panelsStayMonstros-collapseOne">
                                <h5><b>Monstros</b></h5>
                            </button>
                        </h2>

                        <div id="panelsStayMonstros-collapseOne" class="accordion-collapse collapse">
                            <div class="accordion-body">    
                                <div class="accordion" id="accordionPanelsStayMonstrosExample">
                                    <div class="row accordion-item border-0">
                                        ${mission.monsters.map(mon => `
                                            <div class="col-md-3 mb-3">
                                                <div class="card h-100">
                                                <div class="text-center">
                                                    <img src="${mon.img}" style="max-width: 250px;" class=" card-img-top img-fluid rounded" alt="${mon.name}  ">
                                                </div>                                                
                                                <div class="card-body">
                                                    <h6 class="card-title">${mon.name}</h6>
                                                    <p><strong>Ataque:</strong> ${mon.attack}</p>
                                                    <p><strong>Buffs:</strong> ${mon.buffs.join(", ")}</p>
                                                    <p><strong>Debuffs:</strong> ${mon.debuffs.join(", ")}</p>
                                                </div>
                                                </div>
                                            </div>
                                        `).join("")}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Boss -->
                <div class="accordion" id="accordionPanelsStayBossExample">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayBoss-collapseOne" aria-expanded="false" aria-controls="panelsStayBoss-collapseOne">
                            <h5><b>Boss</b></h5>
                        </button>
                        </h2>

                        <div id="panelsStayBoss-collapseOne" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            ${mission.boss.map(b => `
                            <div class="row g-3 align-items-center">
                                <div class="col-md-4 text-center">
                                    <img src="${b.img}" class="img-fluid rounded" alt="${b.name}" style="max-width: 250px;">
                                </div>
                                <div class="col-md-8">
                                    <h5><b>Peculiaridades</b></h5>
                                    <div class="card border-0">
                                        <div class="card-body p-0">
                                            <h6 class="card-title">${b.name}</h6>
                                            <p><strong>Ataque:</strong> ${b.attack}</p>
                                            <p><strong>Buffs:</strong> ${b.buffs.join(", ")}</p>
                                            <p><strong>Debuffs:</strong> ${b.debuffs.join(", ")}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            `).join("")}
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resumo -->
            <div class="card-footer row mw-3">
                <div class="bg-light col-md-4">
                    <h6>Recompensa da missão</h6>
                    <p>
                        Moedas: ${mission.reward.coins}<br>
                        Pontos de Honra: ${mission.reward.honorPoints}<br>
                        Itens: ${mission.reward.items.join(", ")}<br>
                        Experiência: ${mission.reward.experience}
                    </p>
                </div>
                <div class="bg-light col-md-4">
                    <h6>Bônus de eventos e testes</h6>
                    <p id="bonus-content">conteúdo: -</p>
                </div>
                <div class="bg-light col-md-4">
                    <h6>Punições de eventos e testes</h6>
                    <p id="fail-content">conteúdo: -</p>
                </div>
            </div>
            
          </div>
        </div>
      `;

      // aqui fica o observer para simular a reatividade
      bindCheckboxListeners();
    }

    // Função para gerenciar checkboxes (Testes + Eventos)
    function bindCheckboxListeners() {
    document.querySelectorAll(".form-check-input").forEach(chk => {
        chk.addEventListener("change", function() {
        const itemId = this.dataset.id;
        const type = this.dataset.type;
        const context = this.dataset.context; // test ou event
        const accItem = document.getElementById(`${context}-${itemId}`);
        const accButton = accItem.querySelector(".accordion-button");
        const statusIcon = accItem.querySelector(".status-icon");
        const item = mission_selected[context + "s"].find(e => e.id == itemId);

        // Resetar estado visual
        accButton.classList.remove("bg-success", "bg-danger", "text-white");
        statusIcon.textContent = "";

        // Desmarca o outro checkbox
        // A melhoria aqui se daria fazendo limpar o conteudo do marcado anteriormente pois, atualmente so limpa se for desmarcado manualmente.
        if (type === "success") document.getElementById(`fail-${context}-${itemId}`).checked = false;
        if (type === "fail") document.getElementById(`success-${context}-${itemId}`).checked = false;

        // Atualiza arrays de sucessos e falhas
        if (type === "success") {
            if (this.checked) {
            achievements.push(item.success);
            statusIcon.textContent = "✅";
            accButton.classList.add("bg-success", "text-white");
            } else {
            achievements = achievements.filter(a => a !== item.success);
            }
        }

        if (type === "fail") {
            if (this.checked) {
            debuffs.push(item.fail);
            statusIcon.textContent = "❌";
            accButton.classList.add("bg-danger", "text-white");
            } else {
            debuffs = debuffs.filter(d => d !== item.fail);
            }
        }

        // Atualiza footer/resumo
        document.getElementById("bonus-content").textContent = `conteúdo: ${achievements.flat().join(", ") || "-"}`;
        document.getElementById("fail-content").textContent = `conteúdo: ${debuffs.flat().join(", ") || "-"}`;
        });
    });
    }

    // Renderiza a primeira missão ao carregar
    renderMission(missions[0].id);

    // Troca de missão no select
    missionSelect.addEventListener("change", (e) => {
    renderMission(e.target.value);
    });
  </script>
</body>
</html>
